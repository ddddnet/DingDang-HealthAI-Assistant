<template>
	<view class="page-container">
		<wd-notify />
		<!-- Âà§Êñ≠ÁôªÂΩï -->
		<view v-if="login_status">
			<!-- Âà§Êñ≠Âä†ËΩΩÂÆåÊàê -->
			<view v-if="data_done">
				<!-- Êï∞ÊçÆ‰∏∫Á©∫ -->
				<view v-if="data_empty" class="">
					<wd-status-tip image="content" tip="‰ªäÊó•ÊöÇÊó†ËÆ∞ÂΩï" />
					<wd-textarea v-model="emptytisp" readonly></wd-textarea>
				</view>
				<!-- Êï∞ÊçÆ‰∏ç‰∏∫Á©∫ -->
				<view v-if="data_empty == false" class="">
					<view class="grid-box">
						<uni-section class="tite" title="Âü∫Á°ÄÊï∞ÊçÆ " type="line"></uni-section>
						<wd-row>
							<wd-col :span="12">
								<uni-card title="üöÄÂü∫Á°Ä‰ª£Ë∞¢" sub-title="" extra="" >
									<wd-count-to prefix="" :startVal="0" :decimals="0"
										:endVal="health_data.daily.daily_TDEE" :fontSize="32" suffix="cal"
										color="#ff5722"></wd-count-to>
								</uni-card>
							</wd-col>
							<wd-col :span="12">
								<uni-card title="üèÖ‰ΩìÈáç" sub-title="" extra="" >
									<wd-count-to prefix="" :startVal="0" :decimals="2"
										:endVal="health_data.daily.daily_weight" :fontSize="32" suffix="kg"
										color="#ffb800"></wd-count-to>
								</uni-card>
							</wd-col>
							<wd-col :span="12">
								<uni-card title="üîéÊòØÂê¶Ë∂ÖÊ†á(AI)" sub-title="" extra="" >
									<button v-if="health_data.daily.daily_over === 0" type="default">Âê¶</button>
									<button v-if="health_data.daily.daily_over === 1" type="warn">ÊòØ</button>
								</uni-card>
							</wd-col>
							<wd-col :span="12">
								<uni-card title="ü§ñAIÂàÜÊûê" sub-title="" extra="" @click="openAIreport(health_data.daily.daily_id)">
									<button type="default">Êü•Áúã</button>
								</uni-card>
							</wd-col>
						</wd-row>
					</view>
					<view>
						<uni-section class="tite" title="ÂÅ•Â∫∑Êï∞ÊçÆ " type="line"></uni-section>
						<wd-row>
							<wd-col :span="12">
								<uni-card title="ü•£È°øÊï∞" sub-title="" extra="" >
									<wd-count-to prefix="" :startVal="0" :decimals="0"
										:endVal="health_data.daily.daily_count" :fontSize="32" suffix="È°ø"
										color="#1e9fff"></wd-count-to>
								</uni-card>
							</wd-col>
							<wd-col :span="12">
								<uni-card title="üî•Âç°Ë∑ØÈáå" sub-title="" extra="">
									<wd-count-to prefix="" :startVal="0" :decimals="0"
										:endVal="health_data.daily.daily_cal" :fontSize="32" suffix="cal"
										color="#1e9fff"></wd-count-to>
								</uni-card>
							</wd-col>
							<wd-col :span="12">
								<uni-card title="üçöÁ¢≥Ê∞¥" sub-title="" extra="" >
									<wd-count-to prefix="" :startVal="0" :decimals="0"
										:endVal="health_data.daily.daily_carbon" :fontSize="32" suffix="g"
										color="#1e9fff"></wd-count-to>
								</uni-card>
							</wd-col>
							<wd-col :span="12">
								<uni-card title="ü•öËõãÁôΩË¥®" sub-title="" extra="" >
									<wd-count-to prefix="" :startVal="0" :decimals="0"
										:endVal="health_data.daily.daily_protein" :fontSize="32" suffix="g"
										color="#1e9fff"></wd-count-to>
								</uni-card>
							</wd-col>
							<wd-col :span="12">
								<uni-card title="ü•©ËÑÇËÇ™" sub-title="" extra="" >
									<wd-count-to prefix="" :startVal="0" :decimals="0"
										:endVal="health_data.daily.daily_fat" :fontSize="32" suffix="g"
										color="#1e9fff"></wd-count-to>
								</uni-card>
							</wd-col>
							<wd-col :span="12">
								<uni-card title="ü•óËÜ≥È£üÁ∫§Áª¥" sub-title="" extra="" >
									<wd-count-to prefix="" :startVal="0" :decimals="0"
										:endVal="health_data.daily.daily_df" :fontSize="32" suffix="g"
										color="#1e9fff"></wd-count-to>
								</uni-card>
							</wd-col>
						</wd-row>
					</view>


					<view class="record-box">
						<uni-section class="tite" title="ÂÅ•Â∫∑ËÆ∞ÂΩï" type="line"></uni-section>
						<wd-tabs v-model="activeTab" sticky>
							<wd-tab title="‰ªäÊó•">
								<view class="tab-content">
									<!-- ÂàóË°® -->
									<uni-list >
										<uni-list-item v-for="(item,index) in health_data.records" :key="index"
											@click="openList(health_data.records[index].record_type,health_data.records[index].record_id)"
											link
											:title="health_data.records[index].record_title"
											:note="health_data.records[index].record_time_de " showArrow
											:thumb="health_data.records[index].record_url" thumb-size="lg" rightText=""
											/>
									</uni-list>
									<uni-list>
										<uni-list-item title="ÂØπÊï∞ÊçÆÊúâÁñëÈóÆ?" note="Âí®ËØ¢‰∏ì‰∏öÊïôÁªÉ" showArrow thumb="/static/p.png"
											thumb-size="lg" rightText="ÁÇπÂáªÂí®ËØ¢" />
									</uni-list>
								</view>
							</wd-tab>
							<wd-tab title="ÂéÜÂè≤">
								<view class="tab-content">
									<wd-status-tip image="content" tip="ÂºÄÂèë‰∏≠..." />
								</view>
							</wd-tab>
						</wd-tabs>
					</view>
				</view>

			</view>

			<!-- Êú™Âä†ËΩΩÂÆåÊàê -->
			<view v-else class="">
				<!-- È™®Êû∂Â±è -->
				<wd-skeleton v-for="index in 9" theme="paragraph" />
			</view>
		</view>

		<!-- Êú™ÁôªÂΩï -->
		<view v-if="login_status == false">
			<view class="grid-box">
				<uni-section class="tite" title="Âü∫Á°ÄÊï∞ÊçÆ " type="line"></uni-section>
				<wd-row>
					<wd-col :span="12">
						<uni-card title="üöÄÂü∫Á°Ä‰ª£Ë∞¢" sub-title="" extra="" @click="onClick">
							<wd-count-to prefix="" :startVal="0" :decimals="0" :endVal="1560" :fontSize="32"
								suffix="cal" color="#ff5722"></wd-count-to>
						</uni-card>
					</wd-col>
					<wd-col :span="12">
						<uni-card title="üèÖ‰ΩìÈáç" sub-title="" extra="" @click="onClick">
							<wd-count-to prefix="" :startVal="0" :decimals="2" :endVal="50.3" :fontSize="32" suffix="kg"
								color="#ffb800"></wd-count-to>
						</uni-card>
					</wd-col>
					<wd-col :span="12">
						<uni-card title="üîéÊòØÂê¶Ë∂ÖÊ†á" sub-title="" extra="" @click="onClick">
							<button type="warn">ÊòØ</button>
						</uni-card>
					</wd-col>
					<wd-col :span="12">
						<uni-card title="ü§ñAIÂàÜÊûê" sub-title="" extra="" @click="onClick">
							<button type="default">Êü•Áúã</button>
						</uni-card>
					</wd-col>
				</wd-row>
			</view>
			<view>
				<uni-section class="tite" title="ÂÅ•Â∫∑Êï∞ÊçÆ " type="line"></uni-section>
				<wd-row>
					<wd-col :span="12">
						<uni-card title="ü•£È°øÊï∞" sub-title="" extra="" @click="onClick">
							<wd-count-to prefix="" :startVal="0" :decimals="0" :endVal="3" :fontSize="32" suffix="È°ø"
								color="#1e9fff"></wd-count-to>
						</uni-card>
					</wd-col>
					<wd-col :span="12">
						<uni-card title="üî•Âç°Ë∑ØÈáå" sub-title="" extra="" @click="onClick">
							<wd-count-to prefix="" :startVal="0" :decimals="0" :endVal="1560" :fontSize="32"
								suffix="cal" color="#1e9fff"></wd-count-to>
						</uni-card>
					</wd-col>
					<wd-col :span="12">
						<uni-card title="üçöÁ¢≥Ê∞¥" sub-title="" extra="" @click="onClick">
							<wd-count-to prefix="" :startVal="0" :decimals="0" :endVal="1560" :fontSize="32" suffix="g"
								color="#1e9fff"></wd-count-to>
						</uni-card>
					</wd-col>
					<wd-col :span="12">
						<uni-card title="ü•öËõãÁôΩË¥®" sub-title="" extra="" @click="onClick">
							<wd-count-to prefix="" :startVal="0" :decimals="0" :endVal="1560" :fontSize="32" suffix="g"
								color="#1e9fff"></wd-count-to>
						</uni-card>
					</wd-col>
					<wd-col :span="12">
						<uni-card title="ü•©ËÑÇËÇ™" sub-title="" extra="" @click="onClick">
							<wd-count-to prefix="" :startVal="0" :decimals="0" :endVal="1560" :fontSize="32" suffix="g"
								color="#1e9fff"></wd-count-to>
						</uni-card>
					</wd-col>
					<wd-col :span="12">
						<uni-card title="ü•óËÜ≥È£üÁ∫§Áª¥" sub-title="" extra="" @click="onClick">
							<wd-count-to prefix="" :startVal="0" :decimals="0" :endVal="1560" :fontSize="32" suffix="g"
								color="#1e9fff"></wd-count-to>
						</uni-card>
					</wd-col>
				</wd-row>
			</view>


			<view class="record-box">
				<uni-section class="tite" title="ÂÅ•Â∫∑ËÆ∞ÂΩï" type="line"></uni-section>
				<wd-tabs v-model="activeTab" sticky>
					<wd-tab title="‰ªäÊó•">
						<view class="tab-content">
							<wd-status-tip image="search" tip="ËØ∑ÁôªÂΩï" />
						</view>
					</wd-tab>
					<wd-tab title="ÂéÜÂè≤">
						<view class="tab-content">
							<wd-status-tip image="search" tip="ËØ∑ÁôªÂΩï" />
						</view>
					</wd-tab>
				</wd-tabs>
			</view>
			
		</view>

	</view>

</template>

<script>
	import {
		useNotify
	} from '@/uni_modules/wot-design-uni';
	export default {
		setup() {
			const {
				showNotify
			} = useNotify();

			return {
				showNotify
			};
		},
		data() {
			return {
				login_status: false,  // ÁôªÂΩïÁä∂ÊÄÅ
				login_user: "",      // ÁôªÂΩïÁî®Êà∑ID
				login_user_name: "", // ÁôªÂΩïÁî®Êà∑Âêç
				systemInfo: {},      // Á≥ªÁªü‰ø°ÊÅØ
				data_done: false,    // Êï∞ÊçÆÂä†ËΩΩÂÆåÊàêÁä∂ÊÄÅ
				data_empty: null,    // Êï∞ÊçÆÊòØÂê¶‰∏∫Á©∫(null:Êú™Âä†ËΩΩ, true:Á©∫, false:ÊúâÊï∞ÊçÆ)
				isLoading: false,    // Âä†ËΩΩ‰∏≠Áä∂ÊÄÅ
				emptytisp: "ÊèêÁ§∫ÔºöÂàöÂàö‰∏ä‰º†ÂÆåÁÖßÁâáÈúÄË¶ÅÁ≠âÂæÖÊï∞ÂàÜÈíüÊâçËÉΩÁúãÂà∞Êä•Ë°®\n‰∏ãÊãâÂ±èÂπïÂèØ‰ª•Âà∑Êñ∞",
				daily_data: {
					food_count: 0,
				},
				health_data: {}

			}
		},
		onShow() {
			// Ëé∑ÂèñÊâãÊú∫‰ø°ÊÅØ
			uni.getSystemInfo({
				success: (res) => {
					const data = {
						uniPlatform: res.uniPlatform,
						deviceId: res.deviceId,
						osName: res.osName,
					};
					const jsonData = JSON.stringify(data);
					this.systemInfo = jsonData
				},
				fail: (err) => {
					
				}
			})
			
			this.login_user = uni.getStorageSync("login_user")
			
			if (this.login_user) {
				this.login_status = true
				this.login_user_name = uni.getStorageSync("login_user_name")
				this.getRecord()
			}
			// Âº∫Âà∂Êõ¥Êñ∞ËßÜÂõæ
			this.$forceUpdate()
			
		},
		onPullDownRefresh() {
			this.getRecord()
		},
		methods: {
			openAIreport(id){
<<<<<<< HEAD
=======
				console.log("ÊâìÂºÄaiÂàÜÊûê",id)
>>>>>>> 5eb6e8feae16940a32ab49097e8523c6d864fbac
				uni.navigateTo({
					url:"/pages/webview/webview?url=" + this.$host_api + "/get_daily_detail/"+id
				})
			},
			openList(type,id){
<<<<<<< HEAD
=======
				console.log(type,id)
>>>>>>> 5eb6e8feae16940a32ab49097e8523c6d864fbac
				if(type == "food"){
					uni.navigateTo({
						url:"/pages/webview/webview?url=" + this.$host_api + "/get_food_detail/"+id
					})
				}else{
					uni.showToast({
						icon:"none",
						title:"ÁÇπÂáªÈ£üÁâ©ÂèØ‰ª•Êü•ÁúãËØ¶ÊÉÖÂàÜÊûê"
					})
				}
				
			},
			onClick(e) {
				this.showNotify({
					type: "danger",
					message: "ËØ∑ÁôªÂΩï"
				})
			},

			getRecord() {
				let that = this
				this.data_done = false
				// ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ Date ÂØπË±°ÔºåË°®Á§∫ÂΩìÂâçÊó•ÊúüÂíåÊó∂Èó¥
				let today = new Date();
				// Ëé∑ÂèñÂπ¥‰ªΩÔºå‰ΩøÁî® padStart ÊñπÊ≥ïÁ°Æ‰øùÊòØ 4 ‰ΩçÊï∞Â≠ó
				let year = today.getFullYear().toString();
				// Ëé∑ÂèñÊúà‰ªΩÔºåÊúà‰ªΩ‰ªé 0 ÂºÄÂßãÔºåÊâÄ‰ª•ÈúÄË¶ÅÂä† 1Ôºå‰ΩøÁî® padStart ÊñπÊ≥ïÁ°Æ‰øùÊòØ 2 ‰ΩçÊï∞Â≠ó
				let month = (today.getMonth() + 1).toString().padStart(2, '0');
				// Ëé∑ÂèñÊó•ÊúüÔºå‰ΩøÁî® padStart ÊñπÊ≥ïÁ°Æ‰øùÊòØ 2 ‰ΩçÊï∞Â≠ó
				let day = today.getDate().toString().padStart(2, '0');
				// ÊãºÊé•ÊàêÊâÄÈúÄÁöÑÊ†ºÂºè
				let formattedDate = year + month + day;
				console.log(formattedDate)
				uni.request({
					url: this.$host_api + "/getDailyEvent",
					method: "POST",
					data: {
						user: that.login_user,
						date: formattedDate,
						systemInfo: that.systemInfo
					},
					success: (res) => {
						console.log(res)
						if (res.data.code == 1) {
							//Ëé∑ÂèñÊàêÂäü
<<<<<<< HEAD
							that.health_data = res.data.data
							that.data_empty = false  // ÊòéÁ°ÆËÆæÁΩÆdata_empty‰∏∫false
=======
							this.health_data = res.data.data
							this.data_empty = false  // ÊòéÁ°ÆËÆæÁΩÆdata_empty‰∏∫false
>>>>>>> 5eb6e8feae16940a32ab49097e8523c6d864fbac
						} else {
							//‰ªäÊó•Ê≤°ÊúâÊï∞ÊçÆ
							that.data_empty = true
							this.showNotify({
								type: "primary",
								message: "ü§ñ‰ªäÊó•Ê≤°ÊúâËÆ∞ÂΩïÔºåÂø´ÂéªÊâìÂç°Âêß~"
							})
						}
<<<<<<< HEAD
						that.data_done = true
						// Âº∫Âà∂Êõ¥Êñ∞ËßÜÂõæ
						that.$forceUpdate()
=======
						this.data_done = true
						// Âº∫Âà∂Êõ¥Êñ∞ËßÜÂõæ
						this.$forceUpdate()
>>>>>>> 5eb6e8feae16940a32ab49097e8523c6d864fbac

					},
					fail: (err) => {
						that.showNotify({
							type: "danger",
							message: "ü§ñÂä†ËΩΩÂ§±Ë¥•‰∏ãÊãâÈáçËØï~"
						})
					},
					complete() {
						uni.stopPullDownRefresh();
					}
				})
			},


		}
	}
</script>

<style>

</style>